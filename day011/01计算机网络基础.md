# 计算机网络基础

### 1.网络物理连接后主机和主机如何通信？

- 根据地址通信

### 二层地址

- Ethernet以太网
- 网卡MAC地址：（media access control 介质访问控制）48位，6字节 xx-xx-xx-xx-xx-xx
- 二层地址是硬件地址，同一网络间通信需要MAC ，跨网络MAC无效
- MAC地址全球唯一，前24位位OUI，组织唯一标识码
- ipconfig /all查询地址
- MAC地址在网卡的ROM上，不能修改
- 结论：一个网络是一个国家，二层地址是一个身份证号，只能在同一个网络内，标识唯一节点

### 三层地址

- ipv4 internet protocol version 4 因特网协议版本4 
- 32位，4字节，点分十进制，x.x.x.x 0-255取值
- 在整个Internet范围内唯一标识一个节点，相当于护照号
- 电脑需要配置ip，子网掩码，网关，dns1，dns2
- 一般高位为网络位24位，低位为主机位8位
- 相同网络所有主机ip地址网络位要相同
- 不同网络所有主机ip地址的网络位不同，ip地址也不同
- 网关是一个网络的出口，通常是路由器的地址
- 三层设备特点：pc，server，router都有ip地址，二层设备没有ip地址
- 路由器为linux的cli界面

### 实战设置

- 网络1 100.1.1.0/24 主机：.1 .2 .3 网关：.254
- 网络2 200.1.1.0/24 主机：.1 .2 .3 网关：.254
- 进入用户模式：Router>:
- enable en tab补全，进入特权模式，Router#:
- 特权模式命令：show running-config 查看路由器配置 show ip interface brief 查看ip配置
- conf t （configure terminal）进入全局配置模式 Router(config)#
- 配置主机名：hostname R1
- 进入接口配置模式：interface gigabitEthernet 0/0 R1(config if)
- 配置ip：ip address 100.1.1.254 255.255.255.0
- 开启接口：no shutdown
- exit退到全局配置模式
- exit退到特权模式
- show ip interface brief 查看ip配置
- 通过主机ping（三层icmp协议），发送echo request包，看有没有echo reply收到

### 2.主机间通信需要什么条件？

1. 物理连通
2. 正确配置三层ip地址

### 3.主机间通信如何知道网络设备的地址信息？

- 将数据载荷（应用程序的原始信息）封装为有数据报头的信息
- 封装需要有源目的地址信息标识主机，和源目的端口信息标识应用程序
- 双方需要根据相同的协议protocol，协议栈tcp/ip协议栈

### 4.OSI协议的每层含义

- OSI是iso组织规定的open system interconnection，开放系统互联协议
- 下层为上层提供服务
- 发送方从上层到下层封装
- 接收方从下层到上层解封装
- 第7层应用层：为应用程序提供服务，集成在应用程序中
- 第6层表示层：协商双方都支持的数据表示格式，集成在应用程序中
- 第5层会话层：应用程序之间建立连接会话，集成在操作系统中
- 第4层传输层：tcp/udp协议，利用端口号定位应用程序，1-65535，数据切片，封装段报头
- 第3层网络层：ipv4/ipv6协议，路由器利用ip地址唯一标识网络间node进行网络间数据路由转发，封装包报头
- 第2层数据链路层：Ethernet协议，交换机利用mac地址唯一标识网络内node进行网络内数据转发，封装数据帧头和帧尾。
- 第1层物理层：568B线序，规定接口尺寸，线缆尺寸，将数据帧转换为物理信号
- tcp/ip 有第1层物理层，对应osi 1-2，第2层网络层，第3层传输层，第4层应用层，对应osi5-7

### 5.物理层

- 568B线序：橙白 橙 绿白 蓝 蓝白 绿 棕白 棕
- 568A线序：13 26对调
- 直通线：568B-568B，连接不同层设备，如果有端口自适应可以连所有设备
- 交叉线：568B-568A，连接相同层设备
- 5类线100M，超5类，6类，7类1000M，8类10000M
- 双绞线一般采用utp（100M），非屏蔽六类线，多模光纤级联交换机

### 6.数据链路层

- 封装源mac，目的mac
- 局域网使用Ethernet协议，广域网使用ppp协议，如PPPoE
- 数据流量主要用Ethernet2协议
- 控制流量主要用802.3协议
- 全双工：双向流量同时工作，想发就发，想收就收
- 半双工：集线器，双向流量，但在某一时刻只允许一个主机在一个方向上通信，采用csma/cd技术，带冲突检测的载波侦听多路访问技术，最大10Mbps
- Ethernet2是dmac|smac|type|data|fcs
- fcs帧校验序列，采用散列函数，进行crc循环冗余校验，不定长输入，定长输出
- 交换机有mac端口对应表，可以静态设置优先级高，也可以动态学习，300s无新包失效，拔线也失效
- 一般为1000M独享带宽
- 交换机可以分隔冲突域，但是在同一个广播域里

### 7.拓扑

- 总线型：hub集线器，半双工，csma/cd
- 环型：令牌环交换机
- 星型：以太网交换机

### 8.网络层

- 分为ipv4和ipv6
- 封装源ip，目的ip
- ipv4报头长度为20-60字节
- 可以完成数据切片功能，ttl防止路由选择环路，每经过1跳减1,
- 有ToS，服务类别，可以打标做QoS
- 上层协议tcp为6，udp为17，icmp为1
- 全网广播255.255.255.255是在一个广播域，定向广播可以跨网络
- ipv6 128位，分8段，固定报头40字节
- ipv4前面为网络位，后面为主机位
- A类，0开头，1-126/8 0.0.0.0为全网默认路由，127.0.0.0位环回地址,10.0.0.0为内网地址
- B类，10开头，128-191/16 ，172.16.0.0-172.31.0.0为内网地址，169.254.0.0位dhcp地址
- C类，110开头，192-223/24,192.168.0.0为内网地址
- D类，224-239，组播
- E类，240-255，科研，255.255.255.255 全网广播地址
- 主机位全0为网络号，全1为定向广播地址，主机地址要减去2是真实主机个数
- 子网化就是重新定义网络位和主机位的长度
- 借位：将原主机位转换为网络位
- 借n位可以划分为2的n次方个子网
- 子网掩码和ip地址与运算得到网络地址
- vlsm/cidr不定长子网掩码的无类路由器可以进行子网划分的多次借位
- 子网化和nat/pat技术可以延缓ipv4地址的耗尽，园区为内网，边界路由器为公网，vpn或专线打通内网
- 路由器的路由表可以静态指定，也可以动态学习，ospf，rip2，eigrp协议
- 使用traceroute可以跟踪路由，使用ping利用icmp协议看是否连通
- arp地址解析协议可以根据ip地址找到对应的mac，可以静态绑定

### 9.传输层

- tcp传输控制协议 udp数据报协议
- 传输层可以根据mss最大分片大小（小于2层的mtu最大传输单元1500）进行数据切片
- 封装源端口，目的端口
- tcp是面向连接的可靠传输
- udp是无连接的不可靠传输，用来即时通讯
- tcp有如下技术
    + 流控技术（滑动窗口，慢启动，拥塞控制）
    + 序列保证：根据序列号
    + 防丢包：根据ack确认号和重传机制
    + 防冲突：根据校验和
- 但tcp只能单播，还有dos攻击，udp可以组播，允许丢包，报头小
- client端口：临时可用端口，server端口：固定明确端口
- 端口是进程的数字表示
- 1-1023是管理员固定分配的
- 1024-40000是单固定的
- 40000-65535是临时的
- 用户空间的程序需要在内核空间端口注册才能提供服务
- 进程地址为：IP:PORT组成的socket
- mac界定局域网主机，ip界定互联网主机，port界定进程
- 互联网通信是多段本地通信组成的，非本地发送的包需要指向网关的mac为目的mac


### 10.三次握手，四次断开

- 三次握手
    + 1. 客户端syn
    + 2. 服务端ack+syn
    + 3. 客户端ack
- 四次断开
    1. 客户端fin
    2. 服务端ack
    3. 服务端fin
    4. 客户端ack
- TIME_WAIT状态多为服务端主动关闭链接过多
- CLOSE_WAIT状态多为服务端被动关闭链接过多

### 11.主机网络

- 主机也要有路由表：优先级：默认路由大于网络路由大于主机路由
- dns域名解析先看/etc/hosts的本地解析，再看配置的dns路由器
- 将主机接入网络需要配置：
    1. ip/netmask 本地网络
    2. gateway：跨网络
    3. dns服务器（主/备）：基于主机名的通信
- 配置方式为dhcp动态分配，或静态指定（命令或配置文件）
- 命令分为ifcfg类，iproute2类，nm类
- ifcfg类命令：ifconfig，route，netstat（状态统计）
- iproute2类命令：ip（addr link route），ss（状态统计）
- nm类：nmcli：命令行 nmtui：gui
- 配置文件有：/etc/resolve.conf dns配置文件
- /etc/sysconfig/network 主机名配置文件
- /etc/sysconfig/network-scripts/ifcfg-NAME 网卡配置文件

### 12.网卡命名方式

- centos6 传统命名方式 eth# ppp#
- centos7 可预测的命名方案：支持多种不同的命名机制（en：Ethernet wl：wlan）
    1. 主板集成索引号，eno1
    2. 扩展槽，ens1
    3. 总线扩展槽：enp0s3
    4. mac：enxMAC

### 13.网络设备

- 包括cpu，ram（running configuration），nvram（ram存盘到启动配置文件），配置寄存器（0x2102不可配置，0x2142可以配置），flash（操作系统），rom（rommon） ，interface（line console，tty）

